#!/usr/bin/python2.6
# -*- coding: utf-8 -*-

#######本脚本用于增加账户###########
#需要执行add_account_exc，参数包括：oOms节点ip，account名称，account邮箱，account配额
#函数返回一个元组(return_code,output)。第一个元素为0表示成功，为256表示失败；第二个元素返回命令执行打印信息


import subprocess,commands

#添加自定义模块*****
import _create_logfile_zh    #记录日志模块
import read_conf_zh    #获取conf中变量的模块

def add_account_cmd(ip,account_name,email,quota):
    cmd="/home/parastor/bin/sysctl/parastor_pos"+' addaccount'+' accountname='+str(account_name)+' email='+str(email)+' quota='+str(quota)  #实现创建账户命令
    cmd='ssh '+str(ip)+' -C '+"'"+cmd+"'"   #完整命令
    return cmd

def add_account_exc(ip,account_name,email,quota):
    cmd=add_account_cmd(ip,account_name,email,quota)
    print cmd
    (return_code,output)=commands.getstatusoutput(cmd)
    print return_code
    print output
#    _create_logfile_zh.create_logfile(cmd,return_code,output)
    return (cmd,return_code,output)

#函数自验*****
if __name__=="__main__":
    all_argvs=read_conf_zh.get_argvs()
#    add_account_exc(mgr_ip,account_name,email,quota)
    res=add_account_exc(all_argvs['master_mgr_ip'],all_argvs['account_name'],all_argvs['account_email'],0)
#    add_account_exc(all_argvs['master_mgr_ip'],'acc_test','acc_test@sugon.com',0)
    print res

