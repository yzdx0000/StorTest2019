#-*- coding:utf-8 -*
import _sshlistaccounts_lyz1
import _delete_account_lyz
import commands
import _sshListcertificatesHaveReturn_lyz1
import _delete_certificate
import _getAllBucketOfCertificateid_lyz
import _getAllBucketOfCertificateid_lyz
import _delete_object_lyz
import _delete_Bucket_lyz1
import _getAllObjectsOfBucket_lyz
######################################
#函数作用：删除一个系统的所有account
#函数参数：主mgrip
#####################################
def deleteAllAccount(mgrip,oossip):
    #步骤1：查询所有的账户名称
    print 'start'
    dicts={}
    dicts = _sshlistaccounts_lyz1.sshlistaccounts(mgrip)
    if dict==-1:
        return -1
    accountname=dicts.keys()
    print 'accountnames is %s' %accountname
    accountids=[]
    #步骤2：查询每个账户下的certificateid，如果没有certificateid，直接删除该账户，如果有certificateid，查询他所有的桶，如果有桶则查询所有的对象，删除这些对象再删除桶再删除certificateid，再删除account

    for name in accountname:
        accountid=dicts[name][0]
        print 'accountid is %s' %accountid
        #accountids.append(accountid)
        cers = _sshListcertificatesHaveReturn_lyz1.sshListcertificatesHaveReturn(mgrip, accountid)
        if cers==-1:
            return -1
        print 'cers is %s' %cers
        if cers != []:
            buckets=_getAllBucketOfCertificateid_lyz.getAllBucketOfCertificateid(oossip,cers[0])
            if buckets==-1:
                return -1
            for bucket in buckets:
                objects=_getAllObjectsOfBucket_lyz.getAllObjectOfBucket(oossip,bucket,cers[0])
                if objects==-1:
                    return -1
                if objects!=[]:
                    for object in objects:
                        rede=_delete_object_lyz.deleteObject(oossip,bucket,object,cers[0])
                        if rede==-1:
                            return -1
                rede1=_delete_Bucket_lyz1.delete_bucket(oossip,bucket,cers[0])
                if rede1==-1:
                    return -1
            for cer in cers:
                recer=_delete_certificate.deleteCertificate(mgrip, cer)
                if recer==-1:
                    return -1
        red=_delete_account_lyz.acc_del(mgrip, accountid)
        if red==-1:
            return -1
        print 'account %s is deleted' %name
        
if __name__=="__main__":
    deleteAllAccount('10.2.43.211','10.2.43.213')

