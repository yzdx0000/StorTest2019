# -*- coding:utf-8 -*- 
#**********************************************#
#标题：获取桶列表模块
#使用方法：调用函数，指定ostor_ip、AK、SK。
#作者：王建磊
#创建时间：2018/03/21
#**********************************************#
import os,sys
import commands
import AuthSignature

#获取sig函数
def create_sig(sk):
	StringToSign = "GET" + "\n" + "" + "\n" + "" + "\n" + "" + "\n" + "" + "/"
	sig = AuthSignature.mk_sig(sk,StringToSign)
	sig = AuthSignature.mk_sig_code(sig)
	return sig

#创建桶命令生成函数
def get_bucket_list_cmd(ip,AK,SK):
	sig = create_sig(SK)
	part1 = "curl -i http://" 	#拼串片段，无需关注。
	part2 = ":20480" 							 	#拼串片段，无需关注。
	part3 = " -XGET -H \"Authorization: AWS "		#拼串片段，无需关注。
	part4 = ":"
	cmd = ''.join((part1,ip,part2,part3,AK,part4,sig,"\""))#生成创建桶的指令
	return cmd

#创建桶函数
def get_bucket_list(ip,AK,SK):	#输入参数为:"ostor_ip","桶名"，"证书id"
	cmd = get_bucket_list_cmd(ip,AK,SK)
	(return_code,output)=commands.getstatusoutput(cmd)
	return output

#调试代码
if __name__ == '__main__':
	print "please in put ostor_ip ak sk"
	ostor_ip=sys.argv[1]
	ak=sys.argv[2]
	sk=sys.argv[3]
	output = get_bucket_list(ostor_ip,ak,sk)
	print output
