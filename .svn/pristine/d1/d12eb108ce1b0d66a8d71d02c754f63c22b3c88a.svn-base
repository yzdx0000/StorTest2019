#-*- coding : utf-8 -*
import _sshlistaccounts_lyz1
import _delete_account_lyz
import commands
import _sshListcertificatesHaveReturn_lyz1
import _delete_certificate
import _getAllObjectsOfBucket_lyz
import _getAllBucketOfCertificateid_lyz
import _delete_object_lyz
import _delete_Bucket_lyz1
def deletemanyaccount(accountnamelist,mgrip,oossip):
    dicts=_sshlistaccounts_lyz1.sshlistaccounts(mgrip)
    if dicts==-1:
        return -1
    for name in accountnamelist:
        accountid=dicts[name][0]
        print 'accountid is %s' %accountid
        cers=_sshListcertificatesHaveReturn_lyz1.sshListcertificatesHaveReturn(mgrip,accountid)
        if cers==-1:
            return -1
        if cers != []:
            buckets=_getAllBucketOfCertificateid_lyz.getAllBucketOfCertificateid(oossip,cers[0])
            if buckets==-1:
                return -1
            print 'buckets is %s' %buckets
            if buckets!=[]:
                for bucket in buckets:
                    objects=_getAllObjectsOfBucket_lyz.getAllObjectOfBucket(oossip,bucket,cers[0])
                    print 'objects is %s' % objects
                    if objects==-1:
                        return -1
                    if objects!=[]:
                        for object in objects:
                            rede=_delete_object_lyz.deleteObject(oossip,bucket,object,cers[0])
                            print 'delete %s ok' %object
                            if rede==-1:
                                return -1
                    rede1=_delete_Bucket_lyz1.delete_bucket(oossip,bucket,cers[0])
                if rede1==-1:
                    return -1
            for cer in cers:
                recer=_delete_certificate.deleteCertificate(mgrip, cer)
                if recer==-1:
                    return -1
        red = _delete_account_lyz.acc_del(mgrip, accountid)
        if red == -1:
            return -1
        print 'account %s is deleted' % name
                #(status,output)=commands.getstatusoutput('/home/parastor/bin/sysctl/parastor_pos delcertificate certificateid ='+cer)
        '''
        red=_delete_account_lyz.acc_del(mgrip,accountid)
        if red==-1:
            return -1
    '''
if __name__=="__main__":
    names=[]
    #for i in range(0,100):
        #name='zaaaclllllaaa'+str(i)
        #names.append(name)
    deletemanyaccount(['aa','aaa'], '10.2.43.211','10.2.43.213')