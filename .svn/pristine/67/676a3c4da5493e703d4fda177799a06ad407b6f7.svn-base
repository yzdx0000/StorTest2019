#!/usr/bin/python2.6
# -*- coding: utf-8 -*-

#######本脚本用于更新账户认证###########
#需要执行upd_certificate_exc，参数包括：oOss节点ip，certificateid和状态state(有效状态enable，无效状态disable)
#函数返回一个元组(return_code,output)。第一个元素为0表示成功，为256表示失败；第二个元素返回命令执行打印信息

import subprocess,commands   #调用子进程执行shell

#添加自定义模块*****
import _create_logfile_zh    #记录日志模块
import read_conf_zh    #获取conf中变量的模块

#定义”获取更新认证命令“函数，三个参数依次为mgr节点ip、认证id、状态
def upd_certificate_cmd(ip,certificate_id,state):
    cmd='/home/parastor/bin/sysctl/parastor_pos'+' updatecertificate'+' certificateid='+str(certificate_id)+' state='+str(state)  #执行更新账户认证命令本身
    cmd='ssh '+str(ip)+' -C '+"'"+cmd+"'"   #到管理节点去执行更新账户认证命令
    return cmd

#定义”获取更新认证命令“函数，三个参数依次为mgr节点ip、认证id、状>态(enable和disable二者任选其一)
def upd_certificate_exc(ip,certificate_id,state):
    cmd=upd_certificate_cmd(ip,certificate_id,state)
    print cmd
    (return_code,output)=commands.getstatusoutput(cmd)
    print return_code
    print output
    return (cmd,return_code,output)
#函数自验*****
if __name__=="__main__":
    all_argvs=read_conf_zh.get_argvs()
#    upd_certificate_exc(mgr_ip,certificate_id,stat)
    upd_certificate_exc(all_argvs['master_mgr_ip'],all_argvs['certificate_id'],'enable')   

